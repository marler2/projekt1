<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Animal game</title>
    
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="jquery.js"></script>
       
</head>
<body>
    <h1 id="question">Animal quiz</h1>
    <div id="cBox">
        <table id="questionForm">
            <tr></tr>
            <tr></tr>
            <tr></tr>
            <tr></tr>
            <tr></tr>         
        </table>
        <label class="question">Question</label>
        <input id="data" name="data" type="text" value="SOME DATA THAT WILL BE SENT" />
        <button id="btnSubmit" type="text">Send</button>
    </div>         
    <div id="jsondiv"></div>
    <script type="text/javascript">
        $(document).ready(function(){
            
            /**post request, gör arrayn, till JSON innan den skickas*/

           function doPost(data){
                $.post('/addQuestions', JSON.stringify(data),function(result){
                    console.log(result);
                })
            };

            /**get request*/

            function doGet(){
                    $.get('/questions', function(data, status){ 
                        questionGenerator(JSON.parse(data));
                    });
            }
            
            /**uppdaterar tablen med nya frågor*/

            function questionGenerator(arrayOfQuestions){
                $('tr').each(function(index){
                    $(this).html("<td><p id='question"+index+"'>"+arrayOfQuestions[index]+
                        "</p><input type='text' name='question"+index+"'></td><br/>");
                });
            };

            /*  $('input[name="text"]:checked').val(); */

            /**samla upp questionTable:ns innehåll och göra om det till en array som
            skickas till servern*/

            console.log($('input:text').val());

            function questionCollector(){
                
               
                let body = [];
                let answerArray = [];

                $('input:text').each(function(){
                    answerArray.push($(this).val());
                });

                $('tr').each(function(index){
                            body.push($(this).text()+answerArray[index]);
                    });
                return body;
            };
            
            /** detta händer när sidan laddas*/
            /**uppdaterar frågorna*/

            doGet();

              /**
             *  Submit click event 
             */

            $('#btnSubmit').click(function() {

                /**samla upp alla frågor som redan finns*/
                doPost(questionCollector());
                
                /**uppdaterar frågorna*/
                doGet();

            });

        });   
    </script> 
</body>
</html>